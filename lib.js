!function a(d,k,n){function h(c,b){if(!k[c]){if(!d[c]){var e="function"==typeof require&&require;if(!b&&e)return e(c,!0);if(l)return l(c,!0);e=Error("Cannot find module '"+c+"'");throw e.code="MODULE_NOT_FOUND",e;}e=k[c]={exports:{}};d[c][0].call(e.exports,function(b){return h(d[c][1][b]||b)},e,e.exports,a,d,k,n)}return k[c].exports}for(var l="function"==typeof require&&require,f=0;f<n.length;f++)h(n[f]);return h}({1:[function(d,k,n){k.exports.RTCSessionDescription=window.RTCSessionDescription||window.mozRTCSessionDescription; k.exports.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;k.exports.RTCIceCandidate=window.RTCIceCandidate||window.mozRTCIceCandidate},{}],2:[function(d,k,n){function g(b,e,m){if(!(this instanceof g))return new g(b,e,m);l.call(this);this.options=h.extend({serialization:"binary",reliable:!1},m);this.open=!1;this.type="data";this.peer=b;this.provider=e;this.id=this.options.connectionId||g._idPrefix+h.randomToken();this.label=this.options.label|| this.id;this.metadata=this.options.metadata;this.serialization=this.options.serialization;this.reliable=this.options.reliable;this._buffer=[];this._buffering=!1;this.bufferSize=0;this._chunkedData={};this.options._payload&&(this._peerBrowser=this.options._payload.browser);f.startConnection(this,this.options._payload||{originator:!0})}var h=d("./util"),l=d("eventemitter3"),f=d("./negotiator"),c=d("reliable");h.inherits(g,l);g._idPrefix="dc_";g.prototype.initialize=function(b){this._dc=this.dataChannel= b;this._configureDataChannel()};g.prototype._configureDataChannel=function(){var b=this;h.supports.sctp&&(this._dc.binaryType="arraybuffer");this._dc.onopen=function(){h.log("Data channel connection success");b.open=!0;b.emit("open")};!h.supports.sctp&&this.reliable&&(this._reliable=new c(this._dc,h.debug));this._reliable?this._reliable.onmessage=function(e){b.emit("data",e)}:this._dc.onmessage=function(e){b._handleDataMessage(e)};this._dc.onclose=function(e){h.log("DataChannel closed for:",b.peer); b.close()}};g.prototype._handleDataMessage=function(b){var e=this,m=b.data;b=m.constructor;if("binary"===this.serialization||"binary-utf8"===this.serialization){if(b===Blob)return void h.blobToArrayBuffer(m,function(b){m=h.unpack(b);e.emit("data",m)});b===ArrayBuffer?m=h.unpack(m):b===String&&(b=h.binaryStringToArrayBuffer(m),m=h.unpack(b))}else"json"===this.serialization&&(m=JSON.parse(m));if(m.__peerData){b=m.__peerData;var c=this._chunkedData[b]||{data:[],count:0,total:m.total};return c.data[m.n]= m.data,c.count+=1,c.total===c.count&&(delete this._chunkedData[b],m=new Blob(c.data),this._handleDataMessage({data:m})),void(this._chunkedData[b]=c)}this.emit("data",m)};g.prototype.close=function(){this.open&&(this.open=!1,f.cleanup(this),this.emit("close"))};g.prototype.send=function(b,e){if(!this.open)return void this.emit("error",Error("Connection is not open. You should listen for the `open` event before sending messages."));if(this._reliable)return void this._reliable.send(b);var m=this;if("json"=== this.serialization)this._bufferedSend(JSON.stringify(b));else if("binary"===this.serialization||"binary-utf8"===this.serialization){var c=h.pack(b);if((h.chunkedBrowsers[this._peerBrowser]||h.chunkedBrowsers[h.browser])&&!e&&c.size>h.chunkedMTU)return void this._sendChunks(c);h.supports.sctp?h.supports.binaryBlob?this._bufferedSend(c):h.blobToArrayBuffer(c,function(b){m._bufferedSend(b)}):h.blobToBinaryString(c,function(b){m._bufferedSend(b)})}else this._bufferedSend(b)};g.prototype._bufferedSend= function(b){!this._buffering&&this._trySend(b)||(this._buffer.push(b),this.bufferSize=this._buffer.length)};g.prototype._trySend=function(b){try{this._dc.send(b)}catch(m){this._buffering=!0;var e=this;return setTimeout(function(){e._buffering=!1;e._tryBuffer()},100),!1}return!0};g.prototype._tryBuffer=function(){0!==this._buffer.length&&this._trySend(this._buffer[0])&&(this._buffer.shift(),this.bufferSize=this._buffer.length,this._tryBuffer())};g.prototype._sendChunks=function(b){for(var e=h.chunk(b), m=0,c=e.length;m<c;m+=1)b=e[m],this.send(b,!0)};g.prototype.handleMessage=function(b){var e=b.payload;switch(b.type){case "ANSWER":this._peerBrowser=e.browser;f.handleSDP(b.type,this,e.sdp);break;case "CANDIDATE":f.handleCandidate(this,e.candidate);break;default:h.warn("Unrecognized message type:",b.type,"from peer:",this.peer)}};k.exports=g},{"./negotiator":5,"./util":8,eventemitter3:9,reliable:12}],3:[function(d,k,n){window.Socket=d("./socket");window.MediaConnection=d("./mediaconnection");window.DataConnection= d("./dataconnection");window.Peer=d("./peer");window.RTCPeerConnection=d("./adapter").RTCPeerConnection;window.RTCSessionDescription=d("./adapter").RTCSessionDescription;window.RTCIceCandidate=d("./adapter").RTCIceCandidate;window.Negotiator=d("./negotiator");window.util=d("./util");window.BinaryPack=d("js-binarypack")},{"./adapter":1,"./dataconnection":2,"./mediaconnection":4,"./negotiator":5,"./peer":6,"./socket":7,"./util":8,"js-binarypack":10}],4:[function(d,k,n){function g(c,b,e){if(!(this instanceof g))return new g(c,b,e);l.call(this);this.options=h.extend({},e);this.open=!1;this.type="media";this.peer=c;this.provider=b;this.metadata=this.options.metadata;this.localStream=this.options._stream;this.id=this.options.connectionId||g._idPrefix+h.randomToken();this.localStream&&f.startConnection(this,{_stream:this.localStream,originator:!0})}var h=d("./util"),l=d("eventemitter3"),f=d("./negotiator");h.inherits(g,l);g._idPrefix="mc_";g.prototype.addStream=function(c){h.log("Receiving stream",c);this.remoteStream= c;this.emit("stream",c)};g.prototype.handleMessage=function(c){var b=c.payload;switch(c.type){case "ANSWER":f.handleSDP(c.type,this,b.sdp);this.open=!0;break;case "CANDIDATE":f.handleCandidate(this,b.candidate);break;default:h.warn("Unrecognized message type:",c.type,"from peer:",this.peer)}};g.prototype.answer=function(c){if(this.localStream)return void h.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");this.localStream=this.options._payload._stream=c; f.startConnection(this,this.options._payload);c=this.provider._getMessages(this.id);for(var b=0,e=c.length;b<e;b+=1)this.handleMessage(c[b]);this.open=!0};g.prototype.close=function(){this.open&&(this.open=!1,f.cleanup(this),this.emit("close"))};k.exports=g},{"./negotiator":5,"./util":8,eventemitter3:9}],5:[function(d,k,n){var g=d("./util"),h=d("./adapter").RTCPeerConnection,l=d("./adapter").RTCSessionDescription,f=d("./adapter").RTCIceCandidate,c={pcs:{data:{},media:{}},queue:[],_idPrefix:"pc_", startConnection:function(b,e){var m=c._getPeerConnection(b,e);if(b.pc=b.peerConnection=m,"media"===b.type&&e._stream&&m.addStream(e._stream),e.originator){if("data"===b.type){var f={};g.supports.sctp||(f={reliable:e.reliable});m=m.createDataChannel(b.label,f);b.initialize(m)}g.supports.onnegotiationneeded||c._makeOffer(b)}else c.handleSDP("OFFER",b,e.sdp)},_getPeerConnection:function(b,e){c.pcs[b.type]||g.error(b.type+" is not a valid connection type. Maybe you overrode the `type` property somewhere."); c.pcs[b.type][b.peer]||(c.pcs[b.type][b.peer]={});var m;c.pcs[b.type][b.peer];return e.pc&&(m=c.pcs[b.type][b.peer][e.pc]),m&&"stable"===m.signalingState||(m=c._startPeerConnection(b)),m},_startPeerConnection:function(b){g.log("Creating RTCPeerConnection.");var e=c._idPrefix+g.randomToken(),m={};"data"!==b.type||g.supports.sctp?"media"===b.type&&(m={optional:[{DtlsSrtpKeyAgreement:!0}]}):m={optional:[{RtpDataChannels:!0}]};m=new h(b.provider.options.config,m);return c.pcs[b.type][b.peer][e]=m,c._setupListeners(b, m,e),m},_setupListeners:function(b,e,m){var f=b.peer,h=b.id,d=b.provider;g.log("Listening for ICE candidates.");e.onicecandidate=function(e){e.candidate&&(g.log("Received ICE candidates for:",b.peer),d.socket.send({type:"CANDIDATE",payload:{candidate:e.candidate,type:b.type,connectionId:b.id},dst:f}))};e.oniceconnectionstatechange=function(){switch(e.iceConnectionState){case "failed":g.log("iceConnectionState is disconnected, closing connections to "+f);b.emit("error",Error("Negotiation of connection to "+ f+" failed."));b.close();break;case "disconnected":g.log("iceConnectionState is disconnected, closing connections to "+f);b.close();break;case "completed":e.onicecandidate=g.noop}};e.onicechange=e.oniceconnectionstatechange;g.log("Listening for `negotiationneeded`");e.onnegotiationneeded=function(){g.log("`negotiationneeded` triggered");"stable"==e.signalingState?c._makeOffer(b):g.log("onnegotiationneeded triggered when not stable. Is another connection being established?")};g.log("Listening for data channel"); e.ondatachannel=function(b){g.log("Received data channel");b=b.channel;d.getConnection(f,h).initialize(b)};g.log("Listening for remote stream");e.onaddstream=function(b){g.log("Received remote stream");b=b.stream;var e=d.getConnection(f,h);"media"===e.type&&e.addStream(b)}},cleanup:function(b){g.log("Cleaning up PeerConnection to "+b.peer);var e=b.pc;e&&(e.readyState&&"closed"!==e.readyState||"closed"!==e.signalingState)&&(e.close(),b.pc=null)},_makeOffer:function(b){var e=b.pc;e.createOffer(function(m){g.log("Created offer."); !g.supports.sctp&&"data"===b.type&&b.reliable&&(m.sdp=Reliable.higherBandwidthSDP(m.sdp));e.setLocalDescription(m,function(){g.log("Set localDescription: offer","for:",b.peer);b.provider.socket.send({type:"OFFER",payload:{sdp:m,type:b.type,label:b.label,connectionId:b.id,reliable:b.reliable,serialization:b.serialization,metadata:b.metadata,browser:g.browser},dst:b.peer})},function(e){"OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"!=e&&(b.provider.emitError("webrtc", e),g.log("Failed to setLocalDescription, ",e))})},function(e){b.provider.emitError("webrtc",e);g.log("Failed to createOffer, ",e)},b.options.constraints)},_makeAnswer:function(b){var e=b.pc;e.createAnswer(function(c){g.log("Created answer.");!g.supports.sctp&&"data"===b.type&&b.reliable&&(c.sdp=Reliable.higherBandwidthSDP(c.sdp));e.setLocalDescription(c,function(){g.log("Set localDescription: answer","for:",b.peer);b.provider.socket.send({type:"ANSWER",payload:{sdp:c,type:b.type,connectionId:b.id, browser:g.browser},dst:b.peer})},function(e){b.provider.emitError("webrtc",e);g.log("Failed to setLocalDescription, ",e)})},function(e){b.provider.emitError("webrtc",e);g.log("Failed to create answer, ",e)})},handleSDP:function(b,e,m){m=new l(m);var f=e.pc;g.log("Setting remote description",m);f.setRemoteDescription(m,function(){g.log("Set remoteDescription:",b,"for:",e.peer);"OFFER"===b&&c._makeAnswer(e)},function(b){e.provider.emitError("webrtc",b);g.log("Failed to setRemoteDescription, ",b)})}, handleCandidate:function(b,e){b.pc.addIceCandidate(new f({sdpMLineIndex:e.sdpMLineIndex,candidate:e.candidate}));g.log("Added ICE candidate for:",b.peer)}};k.exports=c},{"./adapter":1,"./util":8}],6:[function(d,k,n){function g(b,c){return this instanceof g?(l.call(this),b&&b.constructor==Object?(c=b,b=void 0):b&&(b=b.toString()),c=h.extend({debug:0,host:h.CLOUD_HOST,port:h.CLOUD_PORT,key:"peerjs",path:"/",token:h.randomToken(),config:h.defaultConfig},c),this.options=c,"/"===c.host&&(c.host=window.location.hostname), "/"!==c.path[0]&&(c.path="/"+c.path),"/"!==c.path[c.path.length-1]&&(c.path+="/"),void 0===c.secure&&c.host!==h.CLOUD_HOST&&(c.secure=h.isSecure()),c.logFunction&&h.setLogFunction(c.logFunction),h.setLogLevel(c.debug),h.supports.audioVideo||h.supports.data?h.validateId(b)?h.validateKey(c.key)?c.secure&&"0.peerjs.com"===c.host?void this._delayedAbort("ssl-unavailable","The cloud server currently does not support HTTPS. Please run your own PeerServer to use HTTPS."):(this.destroyed=!1,this.disconnected= !1,this.open=!1,this.connections={},this._lostMessages={},this._initializeServerConnection(),void(b?this._initialize(b):this._retrieveId())):void this._delayedAbort("invalid-key",'API KEY "'+c.key+'" is invalid'):void this._delayedAbort("invalid-id",'ID "'+b+'" is invalid'):void this._delayedAbort("browser-incompatible","The current browser does not support WebRTC")):new g(b,c)}var h=d("./util"),l=d("eventemitter3"),f=d("./socket"),c=d("./mediaconnection"),b=d("./dataconnection");h.inherits(g,l); g.prototype._initializeServerConnection=function(){var b=this;this.socket=new f(this.options.secure,this.options.host,this.options.port,this.options.path,this.options.key,this.options.wsport);this.socket.on("message",function(e){b._handleMessage(e)});this.socket.on("error",function(e){b._abort("socket-error",e)});this.socket.on("disconnected",function(){b.disconnected||(b.emitError("network","Lost connection to server."),b.disconnect())});this.socket.on("close",function(){b.disconnected||b._abort("socket-closed", "Underlying socket is already closed.")})};g.prototype._retrieveId=function(b){var e=this,c=new XMLHttpRequest;b=(this.options.secure?"https://":"http://")+this.options.host+":"+this.options.port+this.options.path+this.options.key+"/id";b+="?ts="+(new Date).getTime()+Math.random();c.open("get",b,!0);c.onerror=function(b){h.error("Error retrieving ID",b);b="";"/"===e.options.path&&e.options.host!==h.CLOUD_HOST&&(b=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."); e._abort("server-error","Could not get an ID from the server."+b)};c.onreadystatechange=function(){if(4===c.readyState)return 200!==c.status?void c.onerror():void e._initialize(c.responseText)};c.send(null)};g.prototype._initialize=function(b){this.id=b;this.socket.start(this.id,this.options.token)};g.prototype._handleMessage=function(e){var f,g=e.type,d=e.payload,l=e.src;switch(g){case "OPEN":this.emit("open",this.id);this.open=!0;break;case "ERROR":this._abort("server-error",d.msg);break;case "ID-TAKEN":this._abort("unavailable-id", "ID `"+this.id+"` is taken");break;case "INVALID-KEY":this._abort("invalid-key",'API KEY "'+this.options.key+'" is invalid');break;case "LEAVE":h.log("Received leave message from",l);this._cleanupPeer(l);break;case "EXPIRE":this.emitError("peer-unavailable","Could not connect to peer "+l);break;case "OFFER":e=d.connectionId;if(f=this.getConnection(l,e),f&&(f.close(),h.warn("Offer received for existing Connection ID:",e)),"media"===d.type)f=new c(l,this,{connectionId:e,_payload:d,metadata:d.metadata}), this._addConnection(l,f),this.emit("call",f);else{if("data"!==d.type)return void h.warn("Received malformed connection type:",d.type);f=new b(l,this,{connectionId:e,_payload:d,metadata:d.metadata,label:d.label,serialization:d.serialization,reliable:d.reliable});this._addConnection(l,f);this.emit("connection",f)}l=this._getMessages(e);e=0;for(d=l.length;e<d;e+=1)f.handleMessage(l[e]);break;default:if(!d)return void h.warn("You received a malformed message from "+l+" of type "+g);d=d.connectionId;(f= this.getConnection(l,d))&&f.pc?f.handleMessage(e):d?this._storeMessage(d,e):h.warn("You received an unrecognized message:",e)}};g.prototype._storeMessage=function(b,c){this._lostMessages[b]||(this._lostMessages[b]=[]);this._lostMessages[b].push(c)};g.prototype._getMessages=function(b){var e=this._lostMessages[b];return e?(delete this._lostMessages[b],e):[]};g.prototype.connect=function(e,c){if(this.disconnected)return h.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."), void this.emitError("disconnected","Cannot connect to new Peer after disconnecting from server.");var f=new b(e,this,c);return this._addConnection(e,f),f};g.prototype.call=function(b,f,d){if(this.disconnected)return h.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),void this.emitError("disconnected","Cannot connect to new Peer after disconnecting from server.");if(!f)return void h.error("To call a peer, you must provide a stream from your browser's `getUserMedia`."); d=d||{};d._stream=f;f=new c(b,this,d);return this._addConnection(b,f),f};g.prototype._addConnection=function(b,c){this.connections[b]||(this.connections[b]=[]);this.connections[b].push(c)};g.prototype.getConnection=function(b,c){var e=this.connections[b];if(!e)return null;for(var f=0,d=e.length;f<d;f++)if(e[f].id===c)return e[f];return null};g.prototype._delayedAbort=function(b,c){var e=this;h.setZeroTimeout(function(){e._abort(b,c)})};g.prototype._abort=function(b,c){h.error("Aborting!");this._lastServerId? this.disconnect():this.destroy();this.emitError(b,c)};g.prototype.emitError=function(b,c){h.error("Error:",c);"string"==typeof c&&(c=Error(c));c.type=b;this.emit("error",c)};g.prototype.destroy=function(){this.destroyed||(this._cleanup(),this.disconnect(),this.destroyed=!0)};g.prototype._cleanup=function(){if(this.connections)for(var b=Object.keys(this.connections),c=0,f=b.length;c<f;c++)this._cleanupPeer(b[c]);this.emit("close")};g.prototype._cleanupPeer=function(b){b=this.connections[b];for(var e= 0,c=b.length;e<c;e+=1)b[e].close()};g.prototype.disconnect=function(){var b=this;h.setZeroTimeout(function(){b.disconnected||(b.disconnected=!0,b.open=!1,b.socket&&b.socket.close(),b.emit("disconnected",b.id),b._lastServerId=b.id,b.id=null)})};g.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)h.log("Attempting reconnection to server with ID "+this._lastServerId),this.disconnected=!1,this._initializeServerConnection(),this._initialize(this._lastServerId);else{if(this.destroyed)throw Error("This peer cannot reconnect to the server. It has already been destroyed."); if(this.disconnected||this.open)throw Error("Peer "+this.id+" cannot reconnect because it is not disconnected from the server!");h.error("In a hurry? We're still trying to make the initial connection!")}};g.prototype.listAllPeers=function(b){b=b||function(){};var e=this,c=new XMLHttpRequest,f=(this.options.secure?"https://":"http://")+this.options.host+":"+this.options.port+this.options.path+this.options.key+"/peers";f+="?ts="+(new Date).getTime()+Math.random();c.open("get",f,!0);c.onerror=function(c){e._abort("server-error", "Could not get peers from the server.");b([])};c.onreadystatechange=function(){if(4===c.readyState){if(401===c.status){var f="";throw f=e.options.host!==h.CLOUD_HOST?"It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":"You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",b([]),Error("It doesn't look like you have permission to list peers IDs. "+f);}b(200!==c.status?[]:JSON.parse(c.responseText))}}; c.send(null)};k.exports=g},{"./dataconnection":2,"./mediaconnection":4,"./socket":7,"./util":8,eventemitter3:9}],7:[function(d,k,n){function g(f,c,b,e,d,h){if(!(this instanceof g))return new g(f,c,b,e,d,h);h=h||b;l.call(this);this.disconnected=!1;this._queue=[];this._httpUrl=(f?"https://":"http://")+c+":"+b+e+d;this._wsUrl=(f?"wss://":"ws://")+c+":"+h+e+"peerjs?key="+d}var h=d("./util"),l=d("eventemitter3");h.inherits(g,l);g.prototype.start=function(f,c){this.id=f;this._httpUrl+="/"+f+"/"+c;this._wsUrl+= "&id="+f+"&token="+c;this._startXhrStream();this._startWebSocket()};g.prototype._startWebSocket=function(f){var c=this;this._socket||(this._socket=new WebSocket(this._wsUrl),this._socket.onmessage=function(b){try{var e=JSON.parse(b.data)}catch(m){return void h.log("Invalid server message",b.data)}c.emit("message",e)},this._socket.onclose=function(b){h.log("Socket closed.");c.disconnected=!0;c.emit("disconnected")},this._socket.onopen=function(){c._timeout&&(clearTimeout(c._timeout),setTimeout(function(){c._http.abort(); c._http=null},5E3));c._sendQueuedMessages();h.log("Socket open")})};g.prototype._startXhrStream=function(f){try{var c=this;this._http=new XMLHttpRequest;this._http._index=1;this._http._streamIndex=f||0;this._http.open("post",this._httpUrl+"/id?i="+this._http._streamIndex,!0);this._http.onerror=function(){clearTimeout(c._timeout);c.emit("disconnected")};this._http.onreadystatechange=function(){2==this.readyState&&this.old?(this.old.abort(),delete this.old):2<this.readyState&&200===this.status&&this.responseText&& c._handleStream(this)};this._http.send(null);this._setHTTPTimeout()}catch(b){h.log("XMLHttpRequest not available; defaulting to WebSockets")}};g.prototype._handleStream=function(f){var c=f.responseText.split("\n");if(f._buffer)for(;0<f._buffer.length;){var b=f._buffer.shift(),e=c[b];try{e=JSON.parse(e)}catch(m){f._buffer.shift(b);break}this.emit("message",e)}if(b=c[f._index])if(f._index+=1,f._index===c.length)f._buffer||(f._buffer=[]),f._buffer.push(f._index-1);else{try{b=JSON.parse(b)}catch(m){return void h.log("Invalid server message", b)}this.emit("message",b)}};g.prototype._setHTTPTimeout=function(){var f=this;this._timeout=setTimeout(function(){var c=f._http;f._wsOpen()?c.abort():(f._startXhrStream(c._streamIndex+1),f._http.old=c)},25E3)};g.prototype._wsOpen=function(){return this._socket&&1==this._socket.readyState};g.prototype._sendQueuedMessages=function(){for(var f=0,c=this._queue.length;f<c;f+=1)this.send(this._queue[f])};g.prototype.send=function(f){if(!this.disconnected){if(!this.id)return void this._queue.push(f);if(!f.type)return void this.emit("error", "Invalid message");var c=JSON.stringify(f);if(this._wsOpen())this._socket.send(c);else{var b=new XMLHttpRequest;f=this._httpUrl+"/"+f.type.toLowerCase();b.open("post",f,!0);b.setRequestHeader("Content-Type","application/json");b.send(c)}}};g.prototype.close=function(){!this.disconnected&&this._wsOpen()&&(this._socket.close(),this.disconnected=!0)};k.exports=g},{"./util":8,eventemitter3:9}],8:[function(d,k,n){var g={iceServers:[{url:"stun:stun.l.google.com:19302"}]},h=1;n=d("js-binarypack");var l= d("./adapter").RTCPeerConnection,f={noop:function(){},CLOUD_HOST:location.hostname,CLOUD_PORT:8008,chunkedBrowsers:{Chrome:1},chunkedMTU:16300,logLevel:0,setLogLevel:function(c){var b=parseInt(c,10);isNaN(parseInt(c,10))?f.logLevel=c?3:0:f.logLevel=b;f.log=f.warn=f.error=f.noop;0<f.logLevel&&(f.error=f._printWith("ERROR"));1<f.logLevel&&(f.warn=f._printWith("WARNING"));2<f.logLevel&&(f.log=f._print)},setLogFunction:function(c){c.constructor!==Function?f.warn("The log function you passed in is not a function. Defaulting to regular logs."): f._print=c},_printWith:function(c){return function(){var b=Array.prototype.slice.call(arguments);b.unshift(c);f._print.apply(f,b)}},_print:function(){var c=!1,b=Array.prototype.slice.call(arguments);b.unshift("PeerJS: ");for(var e=0,f=b.length;e<f;e++)b[e]instanceof Error&&(b[e]="("+b[e].name+") "+b[e].message,c=!0);c?console.error.apply(console,b):console.log.apply(console,b)},defaultConfig:g,browser:window.mozRTCPeerConnection?"Firefox":window.webkitRTCPeerConnection?"Chrome":window.RTCPeerConnection? "Supported":"Unsupported",supports:function(){if(void 0===l)return{};var c=!0,b=!0,e=!1,f=!1,d=!!window.webkitRTCPeerConnection;try{var h=new l(g,{optional:[{RtpDataChannels:!0}]})}catch(q){b=c=!1}if(c)try{var k=h.createDataChannel("_PEERJSTEST")}catch(q){c=!1}if(c){try{k.binaryType="blob",e=!0}catch(q){}k=new l(g,{});try{f=k.createDataChannel("_PEERJSRELIABLETEST",{}).reliable}catch(q){}k.close()}return b&&(b=!!h.addStream),h&&h.close(),{audioVideo:b,data:c,binaryBlob:e,binary:f,reliable:f,sctp:f, onnegotiationneeded:d}}(),validateId:function(c){return!c||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.exec(c)},validateKey:function(c){return!c||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.exec(c)},debug:!1,inherits:function(c,b){c.super_=b;c.prototype=Object.create(b.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}})},extend:function(c,b){for(var e in b)b.hasOwnProperty(e)&&(c[e]=b[e]);return c},pack:n.pack,unpack:n.unpack,log:function(){if(f.debug){var c=!1,b=Array.prototype.slice.call(arguments); b.unshift("PeerJS: ");for(var e=0,h=b.length;e<h;e++)b[e]instanceof Error&&(b[e]="("+b[e].name+") "+b[e].message,c=!0);c?console.error.apply(console,b):console.log.apply(console,b)}},setZeroTimeout:function(c){function b(b){b.source==c&&b.data==f&&(b.stopPropagation&&b.stopPropagation(),e.length&&e.shift()())}var e=[],f="zero-timeout-message";return c.addEventListener?c.addEventListener("message",b,!0):c.attachEvent&&c.attachEvent("onmessage",b),function(b){e.push(b);c.postMessage(f,"*")}}(window), chunk:function(c){for(var b=[],e=c.size,d=index=0,g=Math.ceil(e/f.chunkedMTU);d<e;){var l=Math.min(e,d+f.chunkedMTU);d=c.slice(d,l);b.push({__peerData:h,n:index,data:d,total:g});d=l;index+=1}return h+=1,b},blobToArrayBuffer:function(c,b){var e=new FileReader;e.onload=function(e){b(e.target.result)};e.readAsArrayBuffer(c)},blobToBinaryString:function(c,b){var e=new FileReader;e.onload=function(e){b(e.target.result)};e.readAsBinaryString(c)},binaryStringToArrayBuffer:function(c){for(var b=new Uint8Array(c.length), e=0;e<c.length;e++)b[e]=255&c.charCodeAt(e);return b.buffer},randomToken:function(){return Math.random().toString(36).substr(2)},isSecure:function(){return"https:"===location.protocol}};k.exports=f},{"./adapter":1,"js-binarypack":10}],9:[function(d,k,n){function g(d,f,c){this.fn=d;this.context=f;this.once=c||!1}function h(){}h.prototype._events=void 0;h.prototype.listeners=function(d){if(!this._events||!this._events[d])return[];if(this._events[d].fn)return[this._events[d].fn];for(var f=0,c=this._events[d].length, b=Array(c);f<c;f++)b[f]=this._events[d][f].fn;return b};h.prototype.emit=function(d,f,c,b,e,h){if(!this._events||!this._events[d])return!1;var g,l=this._events[d],m=arguments.length;if("function"==typeof l.fn){switch(l.once&&this.removeListener(d,l.fn,!0),m){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,f),!0;case 3:return l.fn.call(l.context,f,c),!0;case 4:return l.fn.call(l.context,f,c,b),!0;case 5:return l.fn.call(l.context,f,c,b,e),!0;case 6:return l.fn.call(l.context, f,c,b,e,h),!0}var k=1;for(g=Array(m-1);k<m;k++)g[k-1]=arguments[k];l.fn.apply(l.context,g)}else{var n=l.length;for(k=0;k<n;k++)switch(l[k].once&&this.removeListener(d,l[k].fn,!0),m){case 1:l[k].fn.call(l[k].context);break;case 2:l[k].fn.call(l[k].context,f);break;case 3:l[k].fn.call(l[k].context,f,c);break;default:if(!g){var p=1;for(g=Array(m-1);p<m;p++)g[p-1]=arguments[p]}l[k].fn.apply(l[k].context,g)}}return!0};h.prototype.on=function(d,f,c){f=new g(f,c||this);return this._events||(this._events= {}),this._events[d]?this._events[d].fn?this._events[d]=[this._events[d],f]:this._events[d].push(f):this._events[d]=f,this};h.prototype.once=function(d,f,c){f=new g(f,c||this,!0);return this._events||(this._events={}),this._events[d]?this._events[d].fn?this._events[d]=[this._events[d],f]:this._events[d].push(f):this._events[d]=f,this};h.prototype.removeListener=function(d,f,c){if(!this._events||!this._events[d])return this;var b=this._events[d],e=[];if(f&&(b.fn&&(b.fn!==f||c&&!b.once)&&e.push(b),!b.fn))for(var h= 0,g=b.length;h<g;h++)(b[h].fn!==f||c&&!b[h].once)&&e.push(b[h]);return e.length?this._events[d]=1===e.length?e[0]:e:delete this._events[d],this};h.prototype.removeAllListeners=function(d){return this._events?(d?delete this._events[d]:this._events={},this):this};h.prototype.off=h.prototype.removeListener;h.prototype.addListener=h.prototype.on;h.prototype.setMaxListeners=function(){return this};h.EventEmitter=h;h.EventEmitter2=h;h.EventEmitter3=h;k.exports=h},{}],10:[function(d,k,n){function g(b){this.index= 0;this.dataBuffer=b;this.dataView=new Uint8Array(this.dataBuffer);this.length=this.dataBuffer.byteLength}function h(){this.bufferBuilder=new f}function l(b){b=b.charCodeAt(0);return 2047>=b?"00":65535>=b?"000":2097151>=b?"0000":67108863>=b?"00000":"000000"}var f=d("./bufferbuilder").BufferBuilder,c=d("./bufferbuilder").binaryFeatures;k.exports={unpack:function(b){return(new g(b)).unpack()},pack:function(b){var e=new h;return e.pack(b),e.getBuffer()}};g.prototype.unpack=function(){var b=this.unpack_uint8(); if(128>b)return b;if(32>(224^b))return(224^b)-32;var e;if(15>=(e=160^b))return this.unpack_raw(e);if(15>=(e=176^b))return this.unpack_string(e);if(15>=(e=144^b))return this.unpack_array(e);if(15>=(e=128^b))return this.unpack_map(e);switch(b){case 192:return null;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64(); case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 216:return e=this.unpack_uint16(),this.unpack_string(e);case 217:return e=this.unpack_uint32(),this.unpack_string(e);case 218:return e=this.unpack_uint16(),this.unpack_raw(e);case 219:return e=this.unpack_uint32(),this.unpack_raw(e);case 220:return e=this.unpack_uint16(),this.unpack_array(e);case 221:return e=this.unpack_uint32(),this.unpack_array(e); case 222:return e=this.unpack_uint16(),this.unpack_map(e);case 223:return e=this.unpack_uint32(),this.unpack_map(e)}};g.prototype.unpack_uint8=function(){var b=255&this.dataView[this.index];return this.index++,b};g.prototype.unpack_uint16=function(){var b=this.read(2);b=256*(255&b[0])+(255&b[1]);return this.index+=2,b};g.prototype.unpack_uint32=function(){var b=this.read(4);b=256*(256*(256*b[0]+b[1])+b[2])+b[3];return this.index+=4,b};g.prototype.unpack_uint64=function(){var b=this.read(8);b=256* (256*(256*(256*(256*(256*(256*b[0]+b[1])+b[2])+b[3])+b[4])+b[5])+b[6])+b[7];return this.index+=8,b};g.prototype.unpack_int8=function(){var b=this.unpack_uint8();return 128>b?b:b-256};g.prototype.unpack_int16=function(){var b=this.unpack_uint16();return 32768>b?b:b-65536};g.prototype.unpack_int32=function(){var b=this.unpack_uint32();return b<Math.pow(2,31)?b:b-Math.pow(2,32)};g.prototype.unpack_int64=function(){var b=this.unpack_uint64();return b<Math.pow(2,63)?b:b-Math.pow(2,64)};g.prototype.unpack_raw= function(b){if(this.length<this.index+b)throw Error("BinaryPackFailure: index is out of range "+this.index+" "+b+" "+this.length);var e=this.dataBuffer.slice(this.index,this.index+b);return this.index+=b,e};g.prototype.unpack_string=function(b){for(var e,c,f=this.read(b),d=0,h="";d<b;)e=f[d],128>e?(h+=String.fromCharCode(e),d++):32>(192^e)?(c=(192^e)<<6|63&f[d+1],h+=String.fromCharCode(c),d+=2):(c=(15&e)<<12|(63&f[d+1])<<6|63&f[d+2],h+=String.fromCharCode(c),d+=3);return this.index+=b,h};g.prototype.unpack_array= function(b){for(var e=Array(b),c=0;c<b;c++)e[c]=this.unpack();return e};g.prototype.unpack_map=function(b){for(var e={},c=0;c<b;c++){var f=this.unpack(),d=this.unpack();e[f]=d}return e};g.prototype.unpack_float=function(){var b=this.unpack_uint32();return(0==b>>31?1:-1)*(8388607&b|8388608)*Math.pow(2,(b>>23&255)-127-23)};g.prototype.unpack_double=function(){var b=this.unpack_uint32(),e=this.unpack_uint32(),c=(b>>20&2047)-1023;return(0==b>>31?1:-1)*((1048575&b|1048576)*Math.pow(2,c-20)+e*Math.pow(2, c-52))};g.prototype.read=function(b){var e=this.index;if(e+b<=this.length)return this.dataView.subarray(e,e+b);throw Error("BinaryPackFailure: read index out of range");};h.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()};h.prototype.pack=function(b){var e=typeof b;if("string"==e)this.pack_string(b);else if("number"==e)Math.floor(b)===b?this.pack_integer(b):this.pack_double(b);else if("boolean"==e)!0===b?this.bufferBuilder.append(195):!1===b&&this.bufferBuilder.append(194);else if("undefined"== e)this.bufferBuilder.append(192);else{if("object"!=e)throw Error('Type "'+e+'" not yet supported');if(null===b)this.bufferBuilder.append(192);else if(e=b.constructor,e==Array)this.pack_array(b);else if(e==Blob||e==File)this.pack_bin(b);else if(e==ArrayBuffer)c.useArrayBufferView?this.pack_bin(new Uint8Array(b)):this.pack_bin(b);else if("BYTES_PER_ELEMENT"in b)c.useArrayBufferView?this.pack_bin(new Uint8Array(b.buffer)):this.pack_bin(b.buffer);else if(e==Object)this.pack_object(b);else if(e==Date)this.pack_string(b.toString()); else{if("function"!=typeof b.toBinaryPack)throw Error('Type "'+e.toString()+'" not yet supported');this.bufferBuilder.append(b.toBinaryPack())}}this.bufferBuilder.flush()};h.prototype.pack_bin=function(b){var e=b.length||b.byteLength||b.size;if(15>=e)this.pack_uint8(160+e);else if(65535>=e)this.bufferBuilder.append(218),this.pack_uint16(e);else{if(!(4294967295>=e))throw Error("Invalid length");this.bufferBuilder.append(219);this.pack_uint32(e)}this.bufferBuilder.append(b)};h.prototype.pack_string= function(b){var e=600<b.length?(new Blob([b])).size:b.replace(/[^\u0000-\u007F]/g,l).length;if(15>=e)this.pack_uint8(176+e);else if(65535>=e)this.bufferBuilder.append(216),this.pack_uint16(e);else{if(!(4294967295>=e))throw Error("Invalid length");this.bufferBuilder.append(217);this.pack_uint32(e)}this.bufferBuilder.append(b)};h.prototype.pack_array=function(b){var e=b.length;if(15>=e)this.pack_uint8(144+e);else if(65535>=e)this.bufferBuilder.append(220),this.pack_uint16(e);else{if(!(4294967295>=e))throw Error("Invalid length"); this.bufferBuilder.append(221);this.pack_uint32(e)}for(var c=0;c<e;c++)this.pack(b[c])};h.prototype.pack_integer=function(b){if(-32<=b&&127>=b)this.bufferBuilder.append(255&b);else if(0<=b&&255>=b)this.bufferBuilder.append(204),this.pack_uint8(b);else if(-128<=b&&127>=b)this.bufferBuilder.append(208),this.pack_int8(b);else if(0<=b&&65535>=b)this.bufferBuilder.append(205),this.pack_uint16(b);else if(-32768<=b&&32767>=b)this.bufferBuilder.append(209),this.pack_int16(b);else if(0<=b&&4294967295>=b)this.bufferBuilder.append(206), this.pack_uint32(b);else if(-2147483648<=b&&2147483647>=b)this.bufferBuilder.append(210),this.pack_int32(b);else if(-9223372036854775808<=b&&0x7fffffffffffffff>=b)this.bufferBuilder.append(211),this.pack_int64(b);else{if(!(0<=b&&1.8446744073709552E19>=b))throw Error("Invalid integer");this.bufferBuilder.append(207);this.pack_uint64(b)}};h.prototype.pack_double=function(b){var e=0;0>b&&(e=1,b=-b);var c=Math.floor(Math.log(b)/Math.LN2);b=Math.floor((b/Math.pow(2,c)-1)*Math.pow(2,52));var f=Math.pow(2, 32);e=e<<31|c+1023<<20|b/f&1048575;c=b%f;this.bufferBuilder.append(203);this.pack_int32(e);this.pack_int32(c)};h.prototype.pack_object=function(b){var e=Object.keys(b).length;if(15>=e)this.pack_uint8(128+e);else if(65535>=e)this.bufferBuilder.append(222),this.pack_uint16(e);else{if(!(4294967295>=e))throw Error("Invalid length");this.bufferBuilder.append(223);this.pack_uint32(e)}for(var c in b)b.hasOwnProperty(c)&&(this.pack(c),this.pack(b[c]))};h.prototype.pack_uint8=function(b){this.bufferBuilder.append(b)}; h.prototype.pack_uint16=function(b){this.bufferBuilder.append(b>>8);this.bufferBuilder.append(255&b)};h.prototype.pack_uint32=function(b){b&=4294967295;this.bufferBuilder.append((4278190080&b)>>>24);this.bufferBuilder.append((16711680&b)>>>16);this.bufferBuilder.append((65280&b)>>>8);this.bufferBuilder.append(255&b)};h.prototype.pack_uint64=function(b){var c=b/Math.pow(2,32);b%=Math.pow(2,32);this.bufferBuilder.append((4278190080&c)>>>24);this.bufferBuilder.append((16711680&c)>>>16);this.bufferBuilder.append((65280& c)>>>8);this.bufferBuilder.append(255&c);this.bufferBuilder.append((4278190080&b)>>>24);this.bufferBuilder.append((16711680&b)>>>16);this.bufferBuilder.append((65280&b)>>>8);this.bufferBuilder.append(255&b)};h.prototype.pack_int8=function(b){this.bufferBuilder.append(255&b)};h.prototype.pack_int16=function(b){this.bufferBuilder.append((65280&b)>>8);this.bufferBuilder.append(255&b)};h.prototype.pack_int32=function(b){this.bufferBuilder.append(b>>>24&255);this.bufferBuilder.append((16711680&b)>>>16); this.bufferBuilder.append((65280&b)>>>8);this.bufferBuilder.append(255&b)};h.prototype.pack_int64=function(b){var c=Math.floor(b/Math.pow(2,32));b%=Math.pow(2,32);this.bufferBuilder.append((4278190080&c)>>>24);this.bufferBuilder.append((16711680&c)>>>16);this.bufferBuilder.append((65280&c)>>>8);this.bufferBuilder.append(255&c);this.bufferBuilder.append((4278190080&b)>>>24);this.bufferBuilder.append((16711680&b)>>>16);this.bufferBuilder.append((65280&b)>>>8);this.bufferBuilder.append(255&b)}},{"./bufferbuilder":11}], 11:[function(d,k,n){function g(){this._pieces=[];this._parts=[]}var h={};try{var l=(new Blob([]),!1)}catch(c){l=!0}h.useBlobBuilder=l;if(d=!h.useBlobBuilder)try{d=0===(new Blob([new Uint8Array([])])).size}catch(c){d=!0}h.useArrayBufferView=d;k.exports.binaryFeatures=h;var f=k.exports.BlobBuilder;"undefined"!=typeof window&&(f=k.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder);g.prototype.append=function(c){"number"==typeof c?this._pieces.push(c): (this.flush(),this._parts.push(c))};g.prototype.flush=function(){if(0<this._pieces.length){var c=new Uint8Array(this._pieces);h.useArrayBufferView||(c=c.buffer);this._parts.push(c);this._pieces=[]}};g.prototype.getBuffer=function(){if(this.flush(),h.useBlobBuilder){for(var c=new f,b=0,e=this._parts.length;b<e;b++)c.append(this._parts[b]);return c.getBlob()}return new Blob(this._parts)};k.exports.BufferBuilder=g},{}],12:[function(d,k,n){function g(d,f){if(!(this instanceof g))return new g(d);this._dc= d;h.debug=f;this._outgoing={};this._incoming={};this._received={};this._window=1E3;this._mtu=500;this._count=this._interval=0;this._queue=[];this._setupDC()}var h=d("./util");g.prototype.send=function(d){d=h.pack(d);if(d.size<this._mtu)return void this._handleSend(["no",d]);this._outgoing[this._count]={ack:0,chunks:this._chunk(d)};h.debug&&(this._outgoing[this._count].timer=new Date);this._sendWindowedChunks(this._count);this._count+=1};g.prototype._setupInterval=function(){var d=this;this._timeout= setInterval(function(){var f=d._queue.shift();if(f._multiple)for(var c=0,b=f.length;c<b;c+=1)d._intervalSend(f[c]);else d._intervalSend(f)},this._interval)};g.prototype._intervalSend=function(d){var f=this;d=h.pack(d);h.blobToBinaryString(d,function(c){f._dc.send(c)});0===f._queue.length&&(clearTimeout(f._timeout),f._timeout=null)};g.prototype._processAcks=function(){for(var d in this._outgoing)this._outgoing.hasOwnProperty(d)&&this._sendWindowedChunks(d)};g.prototype._handleSend=function(d){for(var f= !0,c=0,b=this._queue.length;c<b;c+=1){var e=this._queue[c];e===d?f=!1:e._multiple&&-1!==e.indexOf(d)&&(f=!1)}f&&(this._queue.push(d),this._timeout||this._setupInterval())};g.prototype._setupDC=function(){var d=this;this._dc.onmessage=function(f){f=f.data;f.constructor===String&&(f=h.binaryStringToArrayBuffer(f),f=h.unpack(f),d._handleMessage(f))}};g.prototype._handleMessage=function(d){var f,c=d[1],b=this._incoming[c],e=this._outgoing[c];switch(d[0]){case "no":c&&this.onmessage(h.unpack(c));break; case "end":if(f=b,this._received[c]=d[2],!f)break;this._ack(c);break;case "ack":if(f=e)f.ack=Math.max(d[2],f.ack),f.ack>=f.chunks.length?(h.log("Time: ",new Date-f.timer),delete this._outgoing[c]):this._processAcks();break;case "chunk":if(!(f=b)){if(!0===this._received[c])break;f={ack:["ack",c,0],chunks:[]};this._incoming[c]=f}b=d[2];f.chunks[b]=new Uint8Array(d[3]);b===f.ack[2]&&this._calculateNextAck(c);this._ack(c);break;default:this._handleSend(d)}};g.prototype._chunk=function(d){for(var f=[], c=d.size,b=0;b<c;){var e=Math.min(c,b+this._mtu);b={payload:d.slice(b,e)};f.push(b);b=e}return h.log("Created",f.length,"chunks."),f};g.prototype._ack=function(d){var f=this._incoming[d].ack;this._received[d]===f[2]&&(this._complete(d),this._received[d]=!0);this._handleSend(f)};g.prototype._calculateNextAck=function(d){d=this._incoming[d];for(var f=d.chunks,c=0,b=f.length;c<b;c+=1)if(void 0===f[c])return void(d.ack[2]=c);d.ack[2]=f.length};g.prototype._sendWindowedChunks=function(d){h.log("sendWindowedChunks for: ", d);for(var f=this._outgoing[d],c=f.chunks,b=[],e=Math.min(f.ack+this._window,c.length),g=f.ack;g<e;g+=1)c[g].sent&&g!==f.ack||(c[g].sent=!0,b.push(["chunk",d,g,c[g].payload]));f.ack+this._window>=c.length&&b.push(["end",d,c.length]);b._multiple=!0;this._handleSend(b)};g.prototype._complete=function(d){h.log("Completed called for",d);var f=this,c=new Blob(this._incoming[d].chunks);h.blobToArrayBuffer(c,function(b){f.onmessage(h.unpack(b))});delete this._incoming[d]};g.higherBandwidthSDP=function(d){var f= navigator.appVersion.match(/Chrome\/(.*?) /);return f&&31>parseInt(f[1].split(".").shift())&&(f=d.split("b=AS:30"),1<f.length)?f[0]+"b=AS:102400"+f[1]:d};g.prototype.onmessage=function(d){};k.exports.Reliable=g},{"./util":13}],13:[function(d,k,n){d=d("js-binarypack");var g={debug:!1,inherits:function(d,g){d.super_=g;d.prototype=Object.create(g.prototype,{constructor:{value:d,enumerable:!1,writable:!0,configurable:!0}})},extend:function(d,g){for(var f in g)g.hasOwnProperty(f)&&(d[f]=g[f]);return d}, pack:d.pack,unpack:d.unpack,log:function(){if(g.debug){for(var d=[],k=0;k<arguments.length;k++)d[k]=arguments[k];d.unshift("Reliable: ");console.log.apply(console,d)}},setZeroTimeout:function(d){function g(b){b.source==d&&b.data==c&&(b.stopPropagation&&b.stopPropagation(),f.length&&f.shift()())}var f=[],c="zero-timeout-message";return d.addEventListener?d.addEventListener("message",g,!0):d.attachEvent&&d.attachEvent("onmessage",g),function(b){f.push(b);d.postMessage(c,"*")}}(this),blobToArrayBuffer:function(d, g){var f=new FileReader;f.onload=function(c){g(c.target.result)};f.readAsArrayBuffer(d)},blobToBinaryString:function(d,g){var f=new FileReader;f.onload=function(c){g(c.target.result)};f.readAsBinaryString(d)},binaryStringToArrayBuffer:function(d){for(var g=new Uint8Array(d.length),f=0;f<d.length;f++)g[f]=255&d.charCodeAt(f);return g.buffer},randomToken:function(){return Math.random().toString(36).substr(2)}};k.exports=g},{"js-binarypack":10}]},{},[3]); Peer.Room=Object.assign(function(d,k){var n=Peer.Room;n.ROOMID=d||"general";n.OPTIONS=k||{};n.list={};n.createServer();return n},{MSG_TYPE:{CHAT:1,NEW_MEMBER:2,RENAME:3,DEPARTURE:5,BROADCAST:6,PING:7,ACK:8,MEMBERS_REQ:9,MEMBERS_REP:10},_events:null,event:Peer.prototype.emit,on:Peer.prototype.on,off:Peer.prototype.off,emptyConnToClients:function(){if(this.connToClients)for(var d in this.connToClients)this.closeClientConnection(this.connToClients[d]);this.connToClients={}},handleConnToClient:function(d){var k= this;this.connToClients[d].on("open",function(){k.broadcast({type:k.MSG_TYPE.NEW_MEMBER,peerid:d,peername:k.connToClients[d].peername});k.connToClients[d].on("error",k.event.bind(k,"error"))});this.connToClients[d].on("data",function(d){switch(d.type){case k.MSG_TYPE.CHAT:k.connToClients[d.peerid].peername=d.peername;k.broadcast({type:k.MSG_TYPE.BROADCAST,peerid:d.peerid,peername:d.peername,data:d.data});break;case k.MSG_TYPE.RENAME:k.connToClients[d.peerid].peername=d.peername,k.broadcast({type:k.MSG_TYPE.RENAME, peerid:d.peerid,peername:d.peername});case k.MSG_TYPE.PING:k.connToClients[d.peerid]._lastPingTimestamp=(new Date).getTime();k.connToClients[d.peerid].send({type:k.MSG_TYPE.ACK,timestamp:(new Date).getTime()});break;case k.MSG_TYPE.MEMBERS_REQ:var g=[],h;for(h in k.connToClients)g.push({peerid:h,peername:k.connToClients[h].peername});k.connToClients[d.peerid].send({type:k.MSG_TYPE.MEMBERS_REP,members:g})}});this.broadcastDepartureOnClose(this.connToClients[d])},broadcastDepartureOnClose:function(d){var k= this;d.on("close",function(){k.closeClientConnection(d)})},closeClientConnection:function(d){d.close();delete this.connToClients[d.peer];d._pingInterval&&clearInterval(d._pingInterval);this.broadcast({type:this.MSG_TYPE.DEPARTURE,peerid:d.peer,peername:d.peername})},broadcast:function(d){for(var k in this.connToClients)this.connToClients[k].send({type:d.type,peerid:d.peerid,peername:d.peername,data:d.data})},createServer:function(){var d=this;this._lastAckTimestamp=null;this.emptyConnToClients(); this.server=new Peer(this.ROOMID,this.OPTIONS);this.server.on("error",function(k){k.toString().match(/ID.*is taken/)&&d.createClient(d.server=null)});this.server.on("open",function(){d.event("server",{id:d.server.id,host:d.server.options.host,port:d.server.options.port});d.createClient();d.server.on("connection",function(k){d.connToClients[k.peer]=k;d.handleConnToClient(k.peer)})})},createClient:function(){var d=this;this.client=new Peer(this.OPTIONS);this.client.on("error",this.event.bind(this,"error")); this.client.on("open",function(k){d.id=k;d.connToServer=d.client.connect(d.ROOMID);d.connToServer.on("open",function(){d.OPTIONS.name&&d.connToServer.send({type:d.MSG_TYPE.RENAME,peerid:d.id,peername:d.OPTIONS.name});d.handleConnToServer();d.client.disconnect();d.refreshMembersInterval&&clearInterval(d.refreshMembersInterval);d.refreshMembers(d);d.refreshMembersInterval=setInterval(d.refreshMembers,3E4,d)})})},send:function(d){this.connToServer.send({type:this.MSG_TYPE.CHAT,peerid:this.client.id|| this.client._lastServerId,peername:this.OPTIONS.name||this.id,data:d})},handleConnToServer:function(){var d=this;this.connToServer.on("error",this.event.bind(this,"error"));this.connToServer.on("data",function(k){switch(k.type){case d.MSG_TYPE.NEW_MEMBER:var n=k.peername||k.peerid;d.list[k.peerid]=n;d.event("join",n);break;case d.MSG_TYPE.RENAME:n=k.peername||k.peerid;d.list[k.peerid]=n;break;case d.MSG_TYPE.BROADCAST:n=k.peername||k.peerid;d.list[k.peerid]=n;d.event("data",{id:k.peerid==d.id?"me": k.peerid,name:n,data:k.data});break;case d.MSG_TYPE.DEPARTURE:n=k.peername||k.peerid;delete d.list[k.peerid];d.event("left",n);break;case d.MSG_TYPE.ACK:if(!d._lastAckTimestamp||d._lastAckTimestamp<k.timestamp)d._lastAckTimestamp=k.timestamp;break;case d.MSG_TYPE.MEMBERS_REP:d.list={};for(var g=0;g<k.members.length;g++){var h=k.members[g];n=h.peername||h.peerid;d.list[h.peerid]=n}}d.event("list",d.list)});this.connToServer.on("close",d.createServer.bind(d))},refreshMembers:function(d){d.connToServer.send({type:d.MSG_TYPE.MEMBERS_REQ, peerid:d.client.id||d.client._lastServerId})}});Peer.version={"node-peer":"1.2.0",peerjs:"0.3.14"}; 